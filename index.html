<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <title>Wardrobe Tool — Rebuild (Shell)</title>

  <!-- PWA manifest (tiny, data-URI) -->
  <link rel="manifest" href='data:application/manifest+json,{
    "name":"Wardrobe & Equipment — Rebuild",
    "short_name":"Wardrobe2",
    "start_url":".",
    "display":"standalone",
    "background_color":"#0b0f14",
    "theme_color":"#0b0f14",
    "icons":[
      {"src":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABS3GwHAAAAaklEQVR4nO3BMQEAAADCoPVPbQ0PoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACeDc1wAAGaT44gAAAAAElFTSuQmCC","sizes":"192x192","type":"image/png"}
    ]
  }' />

  <!-- iOS PWA niceties -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Wardrobe2" />
  <meta name="theme-color" content="#0b0f14" />

  <style>
    :root { --bg:#0b0f14; --fg:#e6eef6; }
    html,body { height:100%; margin:0; }
    body {
      background:var(--bg); color:var(--fg);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      touch-action: none;
    }
    #app { position:fixed; inset:0; padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); }
    #status {
      position:fixed; left:12px; bottom:12px; opacity:.7; font-size:12px;
      background:rgba(255,255,255,.06); backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);
      padding:6px 10px; border-radius:10px;
    }
  </style>

  <!-- PHONEBOOK: import map for Three + addons (pinned to 0.157.0) -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.157.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.157.0/examples/jsm/"
    }
  }
  </script>
</head>
<body>
  <div id="app" role="application" aria-label="Wardrobe Tool v2"></div>
  <div id="status">shell ready</div>

  <!-- Global debugger + loader UI -->
  <script src="./debugger.js"></script>
  <script type="module" src="./loading.js"></script>

  <!-- ENTRY POINT: wires the phonebook and notifies the loader -->
  <script type="module">
    // mark entry task (visible in the loader)
    if (window.Debug && Debug.task) Debug.task.start('entry', 'Bootstrapping entry');

    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { GLTFLoader }   from 'three/addons/loaders/GLTFLoader.js';

    // Expose the phonebook for subsequent modules
    window.Phonebook = { THREE, OrbitControls, GLTFLoader, version: '0.157.0' };

    // Signal to the loader that the phonebook is ready
    window.dispatchEvent(new CustomEvent('app:ready', { detail: { modules: Object.keys(window.Phonebook) }}));
    console.log('[Wardrobe2] entry loaded:', window.Phonebook);
    if (window.Debug) Debug.log('Phonebook ready: three@0.157.0, OrbitControls, GLTFLoader');

    // Update footer badge
    const statusEl = document.getElementById('status');
    if (statusEl) statusEl.textContent = 'phonebook loaded • entry ok';

    // complete entry task
    if (window.Debug && Debug.task) Debug.task.done('entry', 'Entry OK');
  </script>
</body>
</html>